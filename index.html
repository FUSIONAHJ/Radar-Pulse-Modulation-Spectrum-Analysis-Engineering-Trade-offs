<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>HOCSæ¼”ç¤ºï¼šé›·è¾¾è„‰å†²è°ƒåˆ¶ä¸å·¥ç¨‹æƒè¡¡</title>
    <!-- å¼•å…¥ MathJax ç”¨äºæ¸²æŸ“ LaTeX å…¬å¼ -->
    <script>
    MathJax = {
      tex: {
        inlineMath: [['$', '$'], ['\\(', '\\)']]
      }
    };
    </script>
    <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <style>
        :root {
            --primary-color: #2563eb;
            --secondary-color: #1e40af;
            --accent-color: #ef4444;
            --bg-color: #f8fafc;
            --panel-bg: #ffffff;
            --text-color: #1e293b;
            --border-color: #e2e8f0;
        }

        body {
            font-family: 'Segoe UI', system-ui, sans-serif;
            background-color: var(--bg-color);
            color: var(--text-color);
            margin: 0;
            padding: 20px;
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        .container {
            max-width: 1200px;
            width: 100%;
            display: grid;
            grid-template-columns: 350px 1fr;
            gap: 20px;
        }

        /* é¡¶éƒ¨æ ‡é¢˜æ  */
        .header {
            grid-column: 1 / -1;
            background: var(--panel-bg);
            padding: 20px;
            border-radius: 12px;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
            border-left: 6px solid var(--primary-color);
        }

        .header h1 { margin: 0; font-size: 1.5rem; color: var(--secondary-color); }
        .header p { margin: 5px 0 0; color: #64748b; }

        /* å·¦ä¾§é¢æ¿ï¼šé¢˜ç›®ä¸æ§åˆ¶ */
        .left-panel {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        .card {
            background: var(--panel-bg);
            padding: 20px;
            border-radius: 12px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.05);
            border: 1px solid var(--border-color);
        }

        .card h2 {
            font-size: 1.1rem;
            margin-top: 0;
            border-bottom: 2px solid #f1f5f9;
            padding-bottom: 10px;
            color: var(--secondary-color);
        }

        .problem-text {
            font-size: 0.9rem;
            line-height: 1.6;
            color: #475569;
        }

        .control-group {
            margin-bottom: 15px;
        }

        .control-group label {
            display: flex;
            justify-content: space-between;
            font-weight: 600;
            font-size: 0.9rem;
            margin-bottom: 5px;
        }

        input[type="range"] {
            width: 100%;
            cursor: pointer;
            accent-color: var(--primary-color);
        }

        .metric-box {
            background: #f1f5f9;
            padding: 10px;
            border-radius: 8px;
            margin-top: 10px;
            text-align: center;
        }

        .metric-value {
            font-size: 1.2rem;
            font-weight: bold;
            color: var(--primary-color);
            font-family: 'Courier New', monospace;
        }

        .metric-formula {
            font-size: 0.85rem;
            color: #64748b;
            margin-top: 5px;
            font-family: 'Times New Roman', serif;
            font-style: italic;
        }

        /* æƒè¡¡åˆ†æä»ªè¡¨ */
        .tradeoff-meter {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-top: 5px;
            font-size: 0.8rem;
        }
        .bar-container {
            flex-grow: 1;
            height: 8px;
            background: #e2e8f0;
            margin: 0 10px;
            border-radius: 4px;
            overflow: hidden;
        }
        .bar-fill {
            height: 100%;
            transition: width 0.3s, background-color 0.3s;
        }

        /* å³ä¾§é¢æ¿ï¼šå¯è§†åŒ– */
        .right-panel {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        canvas {
            width: 100%;
            height: 300px;
            background: #fff;
            border-radius: 8px;
            border: 1px solid var(--border-color);
        }

        .plot-container {
            position: relative;
        }
        .plot-label {
            position: absolute;
            top: 10px;
            left: 10px;
            background: rgba(255,255,255,0.9);
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 0.85rem;
            font-weight: bold;
            color: #334155;
            box-shadow: 0 1px 2px rgba(0,0,0,0.1);
        }

        /* å…¬å¼æ˜¾ç¤º */
        .formula {
            background: #f8fafc;
            padding: 8px;
            border-left: 3px solid var(--accent-color);
            font-family: 'Times New Roman', serif;
            font-style: italic;
            margin: 10px 0;
            font-size: 0.9rem;
            overflow-x: auto; /* é˜²æ­¢é•¿å…¬å¼æº¢å‡º */
        }

        /* å“åº”å¼ */
        @media (max-width: 768px) {
            .container { grid-template-columns: 1fr; }
        }
    </style>
</head>
<body>

<div class="container">
    <div class="header">
        <h1>HOCS æ¼”ç¤ºï¼šé›·è¾¾è„‰å†²è°ƒåˆ¶ç³»ç»Ÿ</h1>
        <p>Topic: Radar Pulse Modulation Spectrum Analysis & Engineering Trade-offs</p>
    </div>

    <!-- å·¦ä¾§ï¼šé¢˜ç›®ä¸æ§åˆ¶ -->
    <div class="left-panel">
        <div class="card">
            <h2>ğŸ§© é¢˜ç›®èƒŒæ™¯ (Problem Context)</h2>
            <div class="problem-text">
                <p>å·²çŸ¥åŸºå¸¦æ§åˆ¶ä¿¡å· $f(t)$ ä¸ºçŸ©å½¢è„‰å†²ï¼Œè„‰å®½ä¸º $\tau$ã€‚è¯¥ä¿¡å·å¯¹è½½æ³¢ $\cos(\omega_c t)$ è¿›è¡Œè°ƒåˆ¶ï¼Œç”Ÿæˆå‘å°„ä¿¡å· $g(t) = f(t)\cos(\omega_c t)$ã€‚</p>
                <div class="formula">
                    $$G(j\omega) = \frac{E\tau}{2} [\text{Sa}(\frac{(\omega-\omega_c)\tau}{2}) + \text{Sa}(\frac{(\omega+\omega_c)\tau}{2})]$$
                </div>
                <p><strong>æ¢ç©¶ä»»åŠ¡ï¼š</strong>è°ƒæ•´è„‰å®½ $\tau$ï¼Œè§‚å¯Ÿé¢‘è°±å¸¦å®½ $B_{null}$ çš„å˜åŒ–ï¼Œå¹¶åˆ†æè¿™å…¶ä¸­çš„å·¥ç¨‹æƒè¡¡ã€‚</p>
            </div>
        </div>

        <div class="card">
            <h2>ğŸ›ï¸ å‚æ•°æ§åˆ¶ (Controls)</h2>
            
            <div class="control-group">
                <label>
                    <span>è„‰å†²å®½åº¦ $\tau$ (Pulse Width)</span>
                    <span id="val-tau">2.0 s</span>
                </label>
                <input type="range" id="slider-tau" min="0.5" max="5.0" step="0.1" value="2.0">
                <div class="tradeoff-meter">
                    <span>ä½åˆ†è¾¨ç‡</span>
                    <div class="bar-container"><div class="bar-fill" id="bar-res" style="width: 50%; background: #22c55e;"></div></div>
                    <span>é«˜åˆ†è¾¨ç‡</span>
                </div>
                <p style="font-size: 0.8rem; color: #64748b; margin-top: 2px;">*$\tau$ è¶Šå°ï¼Œé›·è¾¾æµ‹è·è¶Šå‡†</p>
            </div>

            <div class="control-group">
                <label>
                    <span>è½½æ³¢é¢‘ç‡ $\omega_c$ (Carrier Freq)</span>
                    <span id="val-wc">20 rad/s</span>
                </label>
                <input type="range" id="slider-wc" min="10" max="40" step="1" value="20">
            </div>

            <div class="metric-box">
                <div style="font-size: 0.8rem; color: #64748b; margin-bottom: 5px;">ç¬¬ä¸€é›¶ç‚¹å¸¦å®½ (Bandwidth)</div>
                <div class="metric-value" id="val-bw">0.00 rad/s</div>
                <div class="metric-formula">
                    $$B_{null} = \frac{4\pi}{\tau}$$
                </div>
                <div class="tradeoff-meter" style="margin-top: 8px;">
                    <span>çª„å¸¦(çœèµ„æº)</span>
                    <div class="bar-container"><div class="bar-fill" id="bar-bw" style="width: 50%; background: #eab308;"></div></div>
                    <span>å®½å¸¦(æ˜“å¹²æ‰°)</span>
                </div>
            </div>
        </div>

        <div class="card" style="background: #eff6ff; border-color: #bfdbfe;">
            <h2 style="color: #1e40af; border-color: #dbeafe;">ğŸ’¡ å·¥ç¨‹æ´å¯Ÿ (Insight)</h2>
            <p class="problem-text" id="insight-text">
                å½“å‰çŠ¶æ€ï¼š...
            </p>
        </div>
    </div>

    <!-- å³ä¾§ï¼šå¯è§†åŒ– -->
    <div class="right-panel">
        <!-- æ—¶åŸŸå›¾ -->
        <div class="card plot-container">
            <div class="plot-label">Time Domain: $g(t) = f(t)\cos(\omega_c t)$</div>
            <canvas id="canvas-time"></canvas>
        </div>

        <!-- é¢‘åŸŸå›¾ -->
        <div class="card plot-container">
            <div class="plot-label">Frequency Domain: $|G(j\omega)|$</div>
            <canvas id="canvas-freq"></canvas>
        </div>
    </div>
</div>

<script>
    // é…ç½®ä¸çŠ¶æ€
    const canvasTime = document.getElementById('canvas-time');
    const canvasFreq = document.getElementById('canvas-freq');
    const ctxTime = canvasTime.getContext('2d');
    const ctxFreq = canvasFreq.getContext('2d');

    // çŠ¶æ€å˜é‡
    let state = {
        tau: 2.0,      // è„‰å®½
        wc: 20,        // è½½æ³¢é¢‘ç‡
        E: 1.0         // å¹…åº¦
    };

    // åˆå§‹åŒ– Canvas å°ºå¯¸
    function resizeCanvas() {
        const dpr = window.devicePixelRatio || 1;
        [canvasTime, canvasFreq].forEach(canvas => {
            const rect = canvas.parentElement.getBoundingClientRect();
            canvas.width = (rect.width - 40) * dpr; // å‡å»padding
            canvas.height = 300 * dpr;
            const ctx = canvas.getContext('2d');
            ctx.scale(dpr, dpr);
            canvas.style.width = `${rect.width - 40}px`;
            canvas.style.height = `300px`;
        });
        draw();
    }

    // æ•°å­¦å‡½æ•°å·¥å…·
    function sinc(x) {
        if (Math.abs(x) < 0.001) return 1;
        return Math.sin(x) / x; // ä½¿ç”¨æ ‡å‡†çš„ sin(x)/x å®šä¹‰ (éå½’ä¸€åŒ–)
    }

    // Sa å‡½æ•° (Sampling function) Sa(x) = sin(x)/x
    // æœ¬é¢˜ä¸­ F(w) = E*tau * Sa(w*tau/2)
    
    // ç»˜å›¾å·¥å…·
    function clearCanvas(ctx, width, height) {
        ctx.clearRect(0, 0, width, height);
        ctx.fillStyle = "#fff";
        ctx.fillRect(0, 0, width, height);
    }

    function drawGrid(ctx, width, height, xLabel, yLabel) {
        ctx.strokeStyle = "#e2e8f0";
        ctx.lineWidth = 1;
        ctx.beginPath();
        // æ¨ªçº¿
        for(let i=0; i<=height; i+=30) {
            ctx.moveTo(0, i); ctx.lineTo(width, i);
        }
        // ç«–çº¿
        for(let i=0; i<=width; i+=width/10) {
            ctx.moveTo(i, 0); ctx.lineTo(i, height);
        }
        ctx.stroke();

        // åæ ‡è½´
        ctx.strokeStyle = "#94a3b8";
        ctx.lineWidth = 2;
        ctx.beginPath();
        // Xè½´
        ctx.moveTo(0, height/2); ctx.lineTo(width, height/2);
        // Yè½´
        ctx.moveTo(width/2, 0); ctx.lineTo(width/2, height);
        ctx.stroke();

        // æ ‡ç­¾
        ctx.fillStyle = "#64748b";
        ctx.font = "12px Arial";
        ctx.fillText(xLabel, width - 20, height/2 - 5);
        ctx.fillText(yLabel, width/2 + 5, 15);
    }

    // ç»˜åˆ¶æ—¶åŸŸ
    function drawTime() {
        const width = canvasTime.width / (window.devicePixelRatio || 1);
        const height = canvasTime.height / (window.devicePixelRatio || 1);
        const scaleX = width / 10; // æ˜¾ç¤º -5s åˆ° 5s
        const scaleY = height / 3; // å¹…åº¦ç¼©æ”¾

        clearCanvas(ctxTime, width, height);
        drawGrid(ctxTime, width, height, "t", "g(t)");

        // ç»˜åˆ¶åŒ…ç»œ (çŸ©å½¢è„‰å†²)
        ctxTime.strokeStyle = "rgba(37, 99, 235, 0.3)"; // æ·¡è“è‰²
        ctxTime.lineWidth = 2;
        ctxTime.setLineDash([5, 5]);
        ctxTime.beginPath();
        
        const halfTau = state.tau / 2;
        const xStart = width/2 - halfTau * scaleX;
        const xEnd = width/2 + halfTau * scaleX;
        
        ctxTime.moveTo(0, height/2);
        ctxTime.lineTo(xStart, height/2);
        ctxTime.lineTo(xStart, height/2 - state.E * scaleY);
        ctxTime.lineTo(xEnd, height/2 - state.E * scaleY);
        ctxTime.lineTo(xEnd, height/2);
        ctxTime.lineTo(width, height/2);
        ctxTime.stroke();
        ctxTime.setLineDash([]);

        // ç»˜åˆ¶è°ƒåˆ¶ä¿¡å·
        ctxTime.strokeStyle = "#2563eb"; // æ·±è“è‰²
        ctxTime.lineWidth = 1.5;
        ctxTime.beginPath();
        
        for (let x = 0; x < width; x++) {
            const t = (x - width/2) / scaleX;
            let val = 0;
            // çŸ©å½¢çª—å†…
            if (Math.abs(t) <= halfTau) {
                val = state.E * Math.cos(state.wc * t);
            }
            const y = height/2 - val * scaleY;
            if (x === 0) ctxTime.moveTo(x, y);
            else ctxTime.lineTo(x, y);
        }
        ctxTime.stroke();

        // æ ‡æ³¨ tau
        ctxTime.fillStyle = "#1e40af";
        ctxTime.fillText(`Ï„ = ${state.tau.toFixed(1)}s`, xEnd + 5, height/2 - state.E * scaleY);
    }

    // ç»˜åˆ¶é¢‘åŸŸ
    function drawFreq() {
        const width = canvasFreq.width / (window.devicePixelRatio || 1);
        const height = canvasFreq.height / (window.devicePixelRatio || 1);
        
        // åŠ¨æ€è°ƒæ•´Xè½´èŒƒå›´ä»¥é€‚åº”æ¬ç§»
        const maxFreq = 60; // æ˜¾ç¤º -60 åˆ° 60 rad/s
        const scaleX = width / (2 * maxFreq);
        const scaleY = height / (state.tau * 1.2); // å½’ä¸€åŒ–å¹…åº¦ï¼Œå› ä¸ºå³°å€¼æ˜¯ E*tau

        clearCanvas(ctxFreq, width, height);
        drawGrid(ctxFreq, width, height, "Ï‰", "|G(jÏ‰)|");

        // ç»˜åˆ¶é¢‘è°±
        ctxFreq.strokeStyle = "#ef4444"; // çº¢è‰²
        ctxFreq.lineWidth = 2;
        ctxFreq.beginPath();

        // è®¡ç®—å…¬å¼: G(w) = 0.5 * E * tau * [Sa((w-wc)tau/2) + Sa((w+wc)tau/2)]
        // è¿™é‡Œåªç”»å¹…åº¦è°±
        
        for (let x = 0; x < width; x++) {
            const w = (x - width/2) / scaleX; // é¢‘ç‡
            
            const term1 = sinc((w - state.wc) * state.tau / 2);
            const term2 = sinc((w + state.wc) * state.tau / 2);
            
            // ç®€å•å åŠ  (å¿½ç•¥ç›¸å¹²å åŠ çš„ç»†èŠ‚ï¼Œä»…å±•ç¤ºåŒ…ç»œæ¦‚å¿µï¼Œå®é™…åŒè¾¹å¸¦éš”å¾—è¿œåŸºæœ¬ä¸å¹²æ‰°)
            const mag = 0.5 * state.E * state.tau * (Math.abs(term1) + Math.abs(term2));
            
            const y = height/2 - mag * scaleY;
            
            if (x === 0) ctxFreq.moveTo(x, y);
            else ctxFreq.lineTo(x, y);
        }
        ctxFreq.stroke();

        // æ ‡æ³¨å¸¦å®½
        // ç¬¬ä¸€é›¶ç‚¹ä½ç½®ï¼š(w - wc)tau/2 = PI => w - wc = 2PI/tau
        // å¸¦å®½ B = 2 * (2PI/tau) = 4PI/tau
        const B = 4 * Math.PI / state.tau;
        const bwPx = B * scaleX; // å¸¦å®½åœ¨å±å¹•ä¸Šçš„åƒç´ å®½åº¦
        const centerPx = width/2 + state.wc * scaleX; // å³è¾¹å¸¦ä¸­å¿ƒ

        // ç”»å¸¦å®½ç®­å¤´
        ctxFreq.strokeStyle = "#000";
        ctxFreq.beginPath();
        const arrowY = height/2 - 20;
        ctxFreq.moveTo(centerPx - bwPx/2, arrowY);
        ctxFreq.lineTo(centerPx + bwPx/2, arrowY);
        // ç®­å¤´ç«¯ç‚¹
        ctxFreq.moveTo(centerPx - bwPx/2 + 5, arrowY - 3);
        ctxFreq.lineTo(centerPx - bwPx/2, arrowY);
        ctxFreq.lineTo(centerPx - bwPx/2 + 5, arrowY + 3);
        ctxFreq.moveTo(centerPx + bwPx/2 - 5, arrowY - 3);
        ctxFreq.lineTo(centerPx + bwPx/2, arrowY);
        ctxFreq.lineTo(centerPx + bwPx/2 - 5, arrowY + 3);
        ctxFreq.stroke();
        
        ctxFreq.fillStyle = "#000";
        ctxFreq.fillText("B_null", centerPx - 15, arrowY - 5);
    }

    function updateMetrics() {
        // æ›´æ–°æ˜¾ç¤ºæ•°å€¼
        document.getElementById('val-tau').textContent = state.tau.toFixed(1) + " s";
        document.getElementById('val-wc').textContent = state.wc + " rad/s";

        // è®¡ç®—å¸¦å®½ B = 4*PI / tau
        const bw = 4 * Math.PI / state.tau;
        document.getElementById('val-bw').textContent = bw.toFixed(2) + " rad/s";

        // æ›´æ–°ä»ªè¡¨ç›˜æ¡
        // Tau: 0.5 - 5.0. åè½¬æ¯”ä¾‹ï¼štauè¶Šå°ï¼Œresè¶Šé«˜
        // ä¿®æ­£é€»è¾‘ï¼štauè¶Šå°ï¼Œåˆ†è¾¨ç‡è¶Šé«˜ï¼Œbarè¶Šæ»¡
        // tau range: 0.5 -> 5.0
        // å¦‚æœ tau=0.5 (æœ€å°), resåº”è¯¥æœ€é«˜(100%)
        // å¦‚æœ tau=5.0 (æœ€å¤§), resåº”è¯¥æœ€ä½(0%)
        const resPercent = ((5.0 - state.tau) / (5.0 - 0.5)) * 100;
        
        const barRes = document.getElementById('bar-res');
        barRes.style.width = resPercent + "%";
        // é¢œè‰²åŠ¨æ€å˜åŒ–ï¼šé«˜ç²¾åº¦(å°tau)å˜ç»¿ï¼Œä½ç²¾åº¦å˜ç°
        barRes.style.background = state.tau < 1.5 ? "#22c55e" : (state.tau > 3.5 ? "#94a3b8" : "#3b82f6");

        // Bandwidth: max approx 25 (when tau=0.5), min approx 2.5.
        const bwPercent = Math.min(100, (bw / 25) * 100);
        const barBw = document.getElementById('bar-bw');
        barBw.style.width = bwPercent + "%";
        // é¢œè‰²åŠ¨æ€å˜åŒ–ï¼šå®½å¸¦(å¤§å¹²æ‰°)å˜çº¢ï¼Œçª„å¸¦å˜é»„/ç»¿
        barBw.style.background = bw > 15 ? "#ef4444" : (bw < 5 ? "#22c55e" : "#eab308");

        // æ›´æ–° Insight æ–‡æœ¬ (éœ€è¦é‡æ–°æ¸²æŸ“å…¬å¼ï¼Œå¦‚æœMathJaxå·²åŠ è½½)
        const insightText = document.getElementById('insight-text');
        if (state.tau < 1.0) {
            insightText.innerHTML = `âš ï¸ <strong>æç«¯æƒ…å†µï¼š</strong> è„‰å†²æçª„ ($\\tau=${state.tau}$)ã€‚<br>ä¼˜ç‚¹ï¼šé›·è¾¾æµ‹è·ç²¾åº¦æé«˜ï¼ˆæ—¶é—´åˆ†è¾¨ç‡å¥½ï¼‰ã€‚<br>ç¼ºç‚¹ï¼šé¢‘è°±ä¸¥é‡å±•å®½ ($B=${bw.toFixed(1)}$)ï¼Œææ˜“å¹²æ‰°é‚»è¿‘ä¿¡é“ï¼`;
        } else if (state.tau > 4.0) {
            insightText.innerHTML = `â„¹ï¸ <strong>æç«¯æƒ…å†µï¼š</strong> è„‰å†²æå®½ ($\\tau=${state.tau}$)ã€‚<br>ä¼˜ç‚¹ï¼šé¢‘å¸¦éå¸¸çª„ ($B=${bw.toFixed(1)}$)ï¼ŒèŠ‚çœé¢‘è°±èµ„æºã€‚<br>ç¼ºç‚¹ï¼šé›·è¾¾æµ‹è·æ¨¡ç³Šï¼Œæ—¶é—´åˆ†è¾¨åŠ›å·®ã€‚`;
        } else {
            insightText.innerHTML = `âš–ï¸ <strong>å·¥ç¨‹æŠ˜ä¸­ï¼š</strong> å½“å‰ $\\tau=${state.tau}$ã€‚<br>è®¾è®¡è€…éœ€è¦åœ¨â€œæµ‹è·ç²¾åº¦â€å’Œâ€œé¢‘è°±å ç”¨â€ä¹‹é—´å¯»æ‰¾å¹³è¡¡ç‚¹ã€‚è¿™ä¹Ÿä½“ç°äº†æ—¶é¢‘ä¸ç¡®å®šæ€§åŸç†ã€‚`;
        }
        
        // è§¦å‘ MathJax é‡æ–°æ¸²æŸ“åŠ¨æ€ç”Ÿæˆçš„æ–‡æœ¬
        if (window.MathJax && window.MathJax.typesetPromise) {
            window.MathJax.typesetPromise([insightText]);
        }
    }

    function draw() {
        drawTime();
        drawFreq();
        updateMetrics();
    }

    // äº‹ä»¶ç›‘å¬
    document.getElementById('slider-tau').addEventListener('input', (e) => {
        state.tau = parseFloat(e.target.value);
        draw();
    });

    document.getElementById('slider-wc').addEventListener('input', (e) => {
        state.wc = parseFloat(e.target.value);
        draw();
    });

    window.addEventListener('resize', resizeCanvas);

    // å¯åŠ¨
    resizeCanvas();

</script>

</body>
</html>